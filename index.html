<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Primary SEO Meta Tags -->
    <title>Enhanced Dynamic Conversation Topic Selector | AI-Powered Conversation Starters</title>
    <meta name="title" content="Enhanced Dynamic Conversation Topic Selector | AI-Powered Conversation Starters">
    <meta name="description" content="Discover engaging conversation starters with our AI-powered topic selector. Generate meaningful dialogue prompts for hobbies, relationships, business, and personal development. Created by ThannxAI.">
    <meta name="keywords" content="conversation starters, AI conversation, topic generator, dialogue prompts, communication tools, social skills, conversation guide, ThannxAI, AI tools, language learning, conversation practice">
    <meta name="author" content="Thanattsitt Thanatt (ThannxAI)">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="en,th">
    <meta name="revisit-after" content="7 days">
    <link rel="canonical" href="https://conversation-topics.thannx.ai/">
    
    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://conversation-topics.thannx.ai/">
    <meta property="og:title" content="AI-Powered Conversation Topic Selector | ThannxAI">
    <meta property="og:description" content="Generate meaningful conversation starters with AI. Perfect for social skills, language practice, and building connections. Free tool by quantum psychologist & AI developer.">
    <meta property="og:image" content="https://conversation-topics.thannx.ai/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="AI Conversation Topic Selector Interface">
    <meta property="og:site_name" content="ThannxAI Conversation Tools">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="th_TH">
    
    <!-- Twitter Card Meta Tags -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://conversation-topics.thannx.ai/">
    <meta property="twitter:title" content="AI-Powered Conversation Topic Selector | ThannxAI">
    <meta property="twitter:description" content="Generate meaningful conversation starters with AI. Perfect for social skills, language practice, and building connections.">
    <meta property="twitter:image" content="https://conversation-topics.thannx.ai/twitter-card.jpg">
    <meta property="twitter:creator" content="@ThannxAI">
    <meta property="twitter:site" content="@ThannxAI">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="application-name" content="AI Conversation Topic Selector">
    <meta name="apple-mobile-web-app-title" content="ThannxAI Topics">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "AI Conversation Topic Selector",
        "description": "Generate meaningful conversation starters with AI technology for better communication and social connections",
        "url": "https://conversation-topics.thannx.ai/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "All",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Person",
            "name": "Thanattsitt Thanatt",
            "alternateName": "ThannxAI",
            "description": "AI Developer & Quantum Psychologist",
            "url": "https://thannx.ai",
            "sameAs": [
                "https://linkedin.com/in/thanattsitt-thanatt",
                "https://github.com/thannxai",
                "https://twitter.com/thannxai"
            ]
        },
        "datePublished": "2024-01-01",
        "dateModified": "2024-12-19",
        "inLanguage": ["en", "th"],
        "isAccessibleForFree": true,
        "audience": {
            "@type": "Audience",
            "audienceType": "General Public"
        },
        "educationalUse": "Communication Skills Development",
        "learningResourceType": "Interactive Tool"
    }
    </script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --border-color: #e5e7eb;
            --border-light: #f3f4f6;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-display: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--primary-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header {
            background: var(--primary-gradient);
            padding: 3rem 2rem 2rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="1000,0 1000,100 0,100"/></svg>');
            background-size: cover;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 2.75rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background: linear-gradient(45deg, #ffffff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: 1rem;
        }

        .creator-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            margin-top: 1rem;
            transition: var(--transition);
            text-decoration: none;
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .creator-badge:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            color: white;
            text-decoration: none;
        }

        .creator-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .content {
            padding: 2.5rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .select-wrapper {
            position: relative;
            background: var(--bg-secondary);
        }

        select {
            width: 100%;
            padding: 1.25rem 3.5rem 1.25rem 1.25rem;
            font-size: 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            font-family: inherit;
            box-shadow: var(--shadow-sm);
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .select-wrapper::after {
            content: '\f107';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
            font-size: 1.1rem;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            font-family: inherit;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: #667eea;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
        }

        .slider-group {
            grid-column: 1 / -1;
        }

        .slider-wrapper {
            position: relative;
            margin-top: 0.75rem;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-gradient);
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-gradient);
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-md);
        }

        .suggestion-container {
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-top: 1.5rem;
            border-left: 4px solid #667eea;
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .suggestion-container.show {
            opacity: 1;
            transform: translateY(0);
        }

        .suggestion-item {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            border-left: 3px solid #f093fb;
            position: relative;
            overflow: hidden;
        }

        .suggestion-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--secondary-gradient);
        }

        .suggestion-item:last-child {
            margin-bottom: 0;
        }

        .suggestion-text {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.6;
            font-weight: 500;
        }

        .suggestion-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        .favorites-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
        }

        .favorites-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .favorite-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border-radius: 8px;
            font-size: 0.95rem;
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .favorite-item:hover {
            box-shadow: var(--shadow-sm);
            transform: translateX(2px);
        }

        .export-controls {
            margin-top: 1.5rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .footer {
            background: var(--bg-tertiary);
            padding: 2rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .footer-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .social-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .copyright {
            font-size: 0.8rem;
            color: var(--text-muted);
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        /* Dark Mode */
        .dark-mode {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-tertiary: #374151;
            --border-color: #374151;
            --border-light: #4b5563;
        }

        .dark-mode .theme-toggle {
            background: rgba(31, 41, 55, 0.9);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
            }
            
            .header {
                padding: 2rem 1.5rem 1.5rem;
            }
            
            .header h1 {
                font-size: 2.25rem;
            }
            
            .content {
                padding: 2rem 1.5rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .btn {
                padding: 1rem;
                font-size: 0.9rem;
            }

            .stats-container {
                gap: 0.75rem;
            }

            .social-links {
                gap: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.875rem;
            }

            .content {
                padding: 1.5rem 1rem;
            }

            .creator-badge {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        /* Performance optimizations */
        .animate__animated {
            animation-duration: 0.6s;
            animation-fill-mode: both;
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Loading states */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="sr-only">Skip to main content</a>

    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
        <i class="fas fa-moon" id="theme-icon" aria-hidden="true"></i>
    </button>

    <div class="container animate__animated animate__fadeInUp">
        <header class="header">
            <div class="header-content">
                <h1>
                    <i class="fas fa-comments" aria-hidden="true"></i>
                    AI Conversation Topic Selector
                </h1>
                <p class="subtitle">Discover engaging conversation starters with AI-powered suggestions</p>
                <a href="https://thannx.ai" class="creator-badge" target="_blank" rel="noopener noreferrer" 
                   aria-label="Visit ThannxAI Portfolio">
                    <div class="creator-avatar" aria-hidden="true">T</div>
                    <span>Created by ThannxAI</span>
                    <i class="fas fa-external-link-alt" style="font-size: 0.7rem;" aria-hidden="true"></i>
                </a>
            </div>
        </header>

        <main id="main-content" class="content">
            <section class="form-group">
                <label for="topicSelect" class="form-label">
                    <i class="fas fa-list" aria-hidden="true"></i>
                    Choose a Conversation Topic
                </label>
                <div class="select-wrapper">
                    <select id="topicSelect" aria-label="Select a conversation topic" required>
                        <option value="" disabled selected>Select a topic...</option>
                        <optgroup label="🗣️ Open Chit Chat">
                            <option value="hobbies">🎨 Hobbies & Pastimes</option>
                            <option value="food">🍜 Food & Preferences</option>
                            <option value="movies">🎬 Movies & Series</option>
                            <option value="music">🎵 Music</option>
                            <option value="family">👨‍👩‍👧‍👦 Family & Friends</option>
                            <option value="work_school">🏢 Work & School Life</option>
                            <option value="nostalgia">📸 Nostalgia & Memories</option>
                            <option value="future">🚀 Future Goals & Plans</option>
                            <option value="hypothetical">🤔 Hypothetical & Fun Scenarios</option>
                            <option value="problem_solving">🧩 Collaborative Problem-Solving</option>
                            <option value="humor">😄 Humor & Lighthearted</option>
                            <option value="philosophy">🤯 Philosophical Discussion</option>
                            <option value="fact_finding">🔍 Fact-Finding & Curiosity</option>
                        </optgroup>
                        <optgroup label="💡 Advice & Support">
                            <option value="self_help">🌱 Self Help</option>
                            <option value="personal_dev">📈 Personal Development</option>
                            <option value="emotional">❤️ Emotional Support</option>
                            <option value="cultural">🌏 Cultural Advice</option>
                            <option value="parenting">👶 Parenting Support</option>
                            <option value="work_advice">💼 Work & Professional Advice</option>
                            <option value="transitions">🔄 Life Transitions</option>
                            <option value="addiction">🆘 Addiction Recovery</option>
                            <option value="identity">🪪 Identity & Belonging</option>
                            <option value="psych_consult">🧠 Psychological Consultation</option>
                            <option value="business_insights">📊 Business Insights</option>
                        </optgroup>
                        <optgroup label="📚 Information-Seeking">
                            <option value="travel">✈️ Travel & Places</option>
                            <option value="cooking">👨‍🍳 Cooking & Food</option>
                            <option value="entertainment">🎭 Entertainment & Pop Culture</option>
                            <option value="sports">⚽ Sports</option>
                            <option value="diy">🔨 DIY & Home Improvement</option>
                            <option value="finance">💰 Financial Knowledge</option>
                            <option value="business_info">🏪 Business</option>
                            <option value="tech">💻 Tech & Engineering</option>
                            <option value="general_knowledge">📖 General Knowledge</option>
                            <option value="civics">🏛️ Civics</option>
                            <option value="politics">🗳️ Politics</option>
                        </optgroup>
                        <optgroup label="🎓 Educational">
                            <option value="meditation">🧘 Meditation & Mindfulness</option>
                            <option value="psychology">🧠 Psychology & Thinking</option>
                            <option value="virtual_trip">🌐 Virtual Field Trip</option>
                        </optgroup>
                    </select>
                </div>
            </section>

            <section class="controls">
                <button class="btn btn-primary" onclick="showSuggestion()" aria-label="Generate new conversation starter">
                    <i class="fas fa-refresh" aria-hidden="true"></i> Generate New
                </button>
                <button class="btn btn-primary" onclick="showMultipleSuggestions(3)" aria-label="Show 3 conversation ideas">
                    <i class="fas fa-list-ul" aria-hidden="true"></i> Show 3 Ideas
                </button>
                <button class="btn btn-secondary" onclick="toggleLanguage('en')" id="btn-en" aria-label="Switch to English">
                    <i class="fas fa-flag-usa" aria-hidden="true"></i> English
                </button>
                <button class="btn btn-secondary" onclick="toggleLanguage('th')" id="btn-th" aria-label="Switch to Thai">
                    <i class="fas fa-flag" aria-hidden="true"></i> ไทย
                </button>
                <button class="btn btn-success" onclick="saveFavorite()" aria-label="Save current topic as favorite">
                    <i class="fas fa-heart" aria-hidden="true"></i> Save Favorite
                </button>
                <button class="btn btn-warning" onclick="sharePrompt()" aria-label="Share current conversation starter">
                    <i class="fas fa-share" aria-hidden="true"></i> Share
                </button>
                
                <div class="slider-group">
                    <label for="dynamicWeight" class="form-label">
                        <i class="fas fa-sliders-h" aria-hidden="true"></i> 
                        AI Creativity Level: <span id="weightValue">50%</span>
                    </label>
                    <div class="slider-wrapper">
                        <input type="range" id="dynamicWeight" class="slider" min="0" max="100" value="50" 
                               aria-label="AI creativity level from 0 to 100 percent">
                    </div>
                </div>
            </section>

            <div id="suggestion" class="suggestion-container" role="region" aria-live="polite" aria-label="Generated conversation starters"></div>

            <section class="stats-container" aria-label="Usage statistics">
                <div class="stat-card">
                    <div class="stat-number" id="totalGenerated">0</div>
                    <div class="stat-label">Generated</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="favoriteCount">0</div>
                    <div class="stat-label">Favorites</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreak">0</div>
                    <div class="stat-label">Daily Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalTime">0m</div>
                    <div class="stat-label">Time Saved</div>
                </div>
            </section>

            <section class="favorites-container" id="favoritesContainer" style="display: none;" role="region" aria-label="Favorite conversation starters">
                <div class="favorites-header">
                    <i class="fas fa-star" aria-hidden="true"></i>
                    <h3>Your Favorite Topics</h3>
                </div>
                <div id="favoritesList"></div>
                <div class="export-controls">
                    <button class="btn btn-secondary" onclick="exportFavorites('json')" aria-label="Export favorites as JSON file">
                        <i class="fas fa-download" aria-hidden="true"></i> Export JSON
                    </button>
                    <button class="btn btn-secondary" onclick="exportFavorites('txt')" aria-label="Export favorites as text file">
                        <i class="fas fa-file-text" aria-hidden="true"></i> Export TXT
                    </button>
                    <button class="btn btn-secondary" onclick="exportFavorites('pdf')" aria-label="Export favorites as PDF">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i> Export PDF
                    </button>
                    <button class="btn btn-secondary" onclick="clearFavorites()" aria-label="Clear all favorite topics">
                        <i class="fas fa-trash" aria-hidden="true"></i> Clear All
                    </button>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-title">ThannxAI - AI Developer & Quantum Psychologist</div>
                <div class="footer-description">
                    Bridging Artificial Intelligence with Human Consciousness through innovative tools and research.
                    This conversation selector uses advanced AI algorithms to generate meaningful dialogue prompts.
                </div>
                <div class="social-links">
                    <a href="https://linkedin.com/in/thanattsitt-thanatt" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn Profile">
                        <i class="fab fa-linkedin-in" aria-hidden="true"></i>
                    </a>
                    <a href="https://github.com/thannxai" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="GitHub Profile">
                        <i class="fab fa-github" aria-hidden="true"></i>
                                            </a>
                    <a href="https://twitter.com/thannxai" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Twitter Profile">
                        <i class="fab fa-twitter" aria-hidden="true"></i>
                    </a>
                    <a href="https://thannx.ai" class="social-link" target="_blank" rel="noopener noreferrer" aria-label="Portfolio Website">
                        <i class="fas fa-globe" aria-hidden="true"></i>
                    </a>
                    <a href="mailto:contact@thannx.ai" class="social-link" aria-label="Email Contact">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                    </a>
                </div>
                <div class="copyright">
                    © 2024 ThannxAI (Thanattsitt Thanatt). All rights reserved. 
                    <a href="#privacy" style="color: inherit; text-decoration: none;">Privacy Policy</a> | 
                    <a href="#terms" style="color: inherit; text-decoration: none;">Terms of Service</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- External Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>

    <script>
        // Enhanced Analytics and Performance Tracking
        class AnalyticsManager {
            constructor() {
                this.startTime = Date.now();
                this.interactions = [];
                this.initializeTracking();
            }

            initializeTracking() {
                // Track page load time
                window.addEventListener('load', () => {
                    const loadTime = Date.now() - this.startTime;
                    this.trackEvent('page_load', { duration: loadTime });
                });

                // Track user engagement
                document.addEventListener('click', (e) => {
                    if (e.target.matches('button, a, select')) {
                        this.trackEvent('interaction', {
                            element: e.target.tagName.toLowerCase(),
                            action: e.target.textContent?.trim() || 'unknown'
                        });
                    }
                });

                // Track time spent
                this.trackTimeSpent();
            }

            trackEvent(event, data = {}) {
                this.interactions.push({
                    event,
                    data,
                    timestamp: new Date().toISOString()
                });

                // Send to analytics (placeholder)
                if (typeof gtag !== 'undefined') {
                    gtag('event', event, data);
                }
            }

            trackTimeSpent() {
                setInterval(() => {
                    const timeSpent = Math.floor((Date.now() - this.startTime) / 1000 / 60);
                    document.getElementById('totalTime').textContent = `${timeSpent}m`;
                }, 60000);
            }

            getEngagementScore() {
                const timeSpent = (Date.now() - this.startTime) / 1000 / 60;
                const interactionCount = this.interactions.length;
                return Math.min(100, Math.floor((interactionCount * timeSpent) / 10));
            }
        }

        // Initialize enhanced libraries
        const notyf = new Notyf({
            duration: 4000,
            position: { x: 'right', y: 'top' },
            types: [
                {
                    type: 'success',
                    background: 'linear-gradient(135deg, #10b981, #059669)',
                    icon: {
                        className: 'fas fa-check',
                        tagName: 'i',
                        color: 'white'
                    }
                },
                {
                    type: 'error',
                    background: 'linear-gradient(135deg, #ef4444, #dc2626)',
                    icon: {
                        className: 'fas fa-exclamation-triangle',
                        tagName: 'i',
                        color: 'white'
                    }
                },
                {
                    type: 'info',
                    background: 'linear-gradient(135deg, #3b82f6, #2563eb)',
                    icon: {
                        className: 'fas fa-info-circle',
                        tagName: 'i',
                        color: 'white'
                    }
                }
            ]
        });

        // Enhanced application state with advanced features
        class TopicSelectorApp {
            constructor() {
                this.select = document.getElementById('topicSelect');
                this.suggestionDiv = document.getElementById('suggestion');
                this.dynamicWeight = document.getElementById('dynamicWeight');
                this.weightValue = document.getElementById('weightValue');
                this.currentLang = 'en';
                this.lastPrompt = '';
                this.stats = this.loadStats();
                this.favorites = this.loadFavorites();
                this.recentlyUsedPrompts = new Set();
                this.analytics = new AnalyticsManager();
                this.aiPersonalities = ['creative', 'analytical', 'empathetic', 'humorous', 'philosophical'];
                this.currentPersonality = 'creative';
                
                this.initializeEventListeners();
                this.initializeAdvancedFeatures();
                this.updateUI();
                this.loadLastTopic();
                this.startPerformanceMonitoring();
            }

            initializeEventListeners() {
                this.dynamicWeight.addEventListener('input', _.debounce(() => {
                    this.weightValue.textContent = `${this.dynamicWeight.value}%`;
                    this.showSuggestion();
                }, 300));

                this.select.addEventListener('change', () => {
                    localStorage.setItem('lastTopic', this.select.value);
                    this.showSuggestion();
                    this.analytics.trackEvent('topic_selected', { topic: this.select.value });
                });

                this.select.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') this.showSuggestion();
                });

                // Auto-save with debouncing
                window.addEventListener('beforeunload', _.debounce(() => {
                    this.saveFavoritesToStorage();
                    this.saveStatsToStorage();
                    this.analytics.trackEvent('session_end', {
                        duration: Date.now() - this.analytics.startTime,
                        engagement: this.analytics.getEngagementScore()
                    });
                }, 100));

                // Add keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'Enter':
                                e.preventDefault();
                                this.showSuggestion();
                                break;
                            case 's':
                                e.preventDefault();
                                this.saveFavorite();
                                break;
                            case 'r':
                                e.preventDefault();
                                this.showMultipleSuggestions(3);
                                break;
                        }
                    }
                });
            }

            initializeAdvancedFeatures() {
                // Initialize speech synthesis if available
                if ('speechSynthesis' in window) {
                    this.speechEnabled = true;
                    this.addSpeechButton();
                }

                // Initialize offline mode detection
                this.initializeOfflineMode();

                // Initialize performance monitoring
                this.initializePerformanceMonitoring();

                // Initialize advanced AI features
                this.initializeAIPersonalities();
            }

            addSpeechButton() {
                const speechBtn = document.createElement('button');
                speechBtn.className = 'btn btn-secondary';
                speechBtn.innerHTML = '<i class="fas fa-volume-up" aria-hidden="true"></i> Read Aloud';
                speechBtn.onclick = () => this.speakPrompt();
                speechBtn.setAttribute('aria-label', 'Read conversation starter aloud');
                
                const controls = document.querySelector('.controls');
                controls.appendChild(speechBtn);
            }

            speakPrompt() {
                if (!this.lastPrompt) {
                    notyf.error('Generate a prompt first!');
                    return;
                }

                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(this.lastPrompt);
                    utterance.rate = 0.8;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    
                    if (this.currentLang === 'th') {
                        utterance.lang = 'th-TH';
                    } else {
                        utterance.lang = 'en-US';
                    }
                    
                    speechSynthesis.speak(utterance);
                    notyf.success('Reading prompt aloud...');
                    this.analytics.trackEvent('speech_synthesis', { language: this.currentLang });
                }
            }

            initializeOfflineMode() {
                window.addEventListener('online', () => {
                    notyf.success('Back online! All features available.');
                });

                window.addEventListener('offline', () => {
                    notyf.info('Offline mode - Some features may be limited.');
                });
            }

            initializePerformanceMonitoring() {
                if ('PerformanceObserver' in window) {
                    const observer = new PerformanceObserver((list) => {
                        list.getEntries().forEach((entry) => {
                            if (entry.entryType === 'navigation') {
                                this.analytics.trackEvent('performance', {
                                    loadTime: entry.loadEventEnd - entry.loadEventStart,
                                    domContentLoaded: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart
                                });
                            }
                        });
                    });
                    observer.observe({ entryTypes: ['navigation'] });
                }
            }

            initializeAIPersonalities() {
                const personalitySelector = document.createElement('div');
                personalitySelector.className = 'slider-group';
                personalitySelector.innerHTML = `
                    <label class="form-label">
                        <i class="fas fa-robot" aria-hidden="true"></i> AI Personality: <span id="personalityValue">Creative</span>
                    </label>
                    <select id="personalitySelect" class="btn btn-secondary" style="width: 100%; padding: 0.5rem;">
                        <option value="creative">🎨 Creative</option>
                        <option value="analytical">🔬 Analytical</option>
                        <option value="empathetic">❤️ Empathetic</option>
                        <option value="humorous">😄 Humorous</option>
                        <option value="philosophical">🤔 Philosophical</option>
                    </select>
                `;

                const controls = document.querySelector('.controls');
                controls.appendChild(personalitySelector);

                document.getElementById('personalitySelect').addEventListener('change', (e) => {
                    this.currentPersonality = e.target.value;
                    document.getElementById('personalityValue').textContent = 
                        e.target.selectedOptions[0].textContent.split(' ')[1];
                    this.analytics.trackEvent('personality_changed', { personality: this.currentPersonality });
                });
            }

            startPerformanceMonitoring() {
                // Monitor memory usage
                if ('memory' in performance) {
                    setInterval(() => {
                        const memInfo = performance.memory;
                        if (memInfo.usedJSHeapSize > memInfo.totalJSHeapSize * 0.9) {
                            console.warn('High memory usage detected');
                        }
                    }, 30000);
                }
            }

            loadStats() {
                const defaultStats = {
                    totalGenerated: 0,
                    favoriteCount: 0,
                    currentStreak: 0,
                    lastUsedDate: null,
                    totalSessions: 0,
                    averageRating: 0,
                    topTopics: {},
                    languagePreference: 'en',
                    personalityUsage: {}
                };
                
                try {
                    const saved = localStorage.getItem('topicSelectorStats');
                    return saved ? { ...defaultStats, ...JSON.parse(saved) } : defaultStats;
                } catch {
                    return defaultStats;
                }
            }

            saveStatsToStorage() {
                // Update top topics
                const currentTopic = this.select.value;
                if (currentTopic) {
                    this.stats.topTopics[currentTopic] = (this.stats.topTopics[currentTopic] || 0) + 1;
                }

                // Update personality usage
                this.stats.personalityUsage[this.currentPersonality] = 
                    (this.stats.personalityUsage[this.currentPersonality] || 0) + 1;

                localStorage.setItem('topicSelectorStats', JSON.stringify(this.stats));
            }

            loadFavorites() {
                try {
                    const saved = localStorage.getItem('topicSelectorFavorites');
                    return saved ? JSON.parse(saved) : [];
                } catch {
                    return [];
                }
            }

            saveFavoritesToStorage() {
                localStorage.setItem('topicSelectorFavorites', JSON.stringify(this.favorites));
            }

            updateUI() {
                document.getElementById('totalGenerated').textContent = this.stats.totalGenerated;
                document.getElementById('favoriteCount').textContent = this.favorites.length;
                document.getElementById('currentStreak').textContent = this.stats.currentStreak;
                
                this.updateFavoritesDisplay();
                this.updateStreakCounter();
                this.updateRecommendations();
            }

            updateStreakCounter() {
                const today = moment().format('YYYY-MM-DD');
                const lastUsed = this.stats.lastUsedDate;
                
                if (lastUsed) {
                    const daysDiff = moment(today).diff(moment(lastUsed), 'days');
                    if (daysDiff === 1) {
                        // Continue streak
                    } else if (daysDiff > 1) {
                        this.stats.currentStreak = 0;
                    }
                }
                
                if (lastUsed !== today) {
                    this.stats.currentStreak++;
                    this.stats.lastUsedDate = today;
                    this.stats.totalSessions++;
                }
            }

            updateRecommendations() {
                // Show topic recommendations based on usage
                if (Object.keys(this.stats.topTopics).length > 0) {
                    const topTopic = Object.keys(this.stats.topTopics).reduce((a, b) => 
                        this.stats.topTopics[a] > this.stats.topTopics[b] ? a : b
                    );
                    
                    if (Math.random() < 0.1) { // Show occasionally
                        notyf.open({
                            type: 'info',
                            message: `💡 Your favorite topic is "${topTopic}". Try exploring related categories!`
                        });
                    }
                }
            }

            updateFavoritesDisplay() {
                const container = document.getElementById('favoritesContainer');
                const list = document.getElementById('favoritesList');
                
                if (this.favorites.length === 0) {
                    container.style.display = 'none';
                    return;
                }
                
                container.style.display = 'block';
                list.innerHTML = this.favorites.map((fav, index) => `
                    <div class="favorite-item">
                        <div>
                            <strong>${fav.text}</strong>
                            <br>
                            <small style="color: var(--text-muted);">
                                ${fav.topic} • ${fav.language.toUpperCase()} • ${moment(fav.timestamp).format('MMM DD, YYYY')}
                            </small>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="app.reusePrompt(${index})" 
                                    style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                    aria-label="Reuse this prompt">
                                <i class="fas fa-redo" aria-hidden="true"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="app.removeFavorite(${index})" 
                                    style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                    aria-label="Remove from favorites">
                                <i class="fas fa-times" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            loadLastTopic() {
                const lastTopic = localStorage.getItem('lastTopic');
                if (lastTopic && this.select.querySelector(`option[value="${lastTopic}"]`)) {
                    this.select.value = lastTopic;
                    setTimeout(() => this.showSuggestion(), 500);
                }
            }

            // Enhanced prompt generation with personality
            generateDynamicPrompt(category, subCategory) {
                const templates = (this.currentLang === 'en' ? dynamicTemplates : dynamicTemplatesThai)[category]?.[subCategory] || ['What\'s something interesting about this topic?'];
                let prompt = templates[Math.floor(Math.random() * templates.length)];

                // Apply personality modifications
                prompt = this.applyPersonality(prompt);

                // Enhanced filler replacement
                const enhancedFillers = {
                    ...fillers,
                    emotion: ['excited', 'curious', 'passionate', 'thoughtful', 'enthusiastic'],
                    timeframe: ['recently', 'this week', 'lately', 'in the past month', 'nowadays'],
                    intensity: ['really', 'absolutely', 'completely', 'totally', 'genuinely'],
                    personality_creative: ['innovative', 'imaginative', 'artistic', 'original'],
                    personality_analytical: ['systematic', 'logical', 'methodical', 'data-driven'],
                    personality_empathetic: ['understanding', 'caring', 'supportive', 'compassionate'],
                    personality_humorous: ['funny', 'witty', 'amusing', 'entertaining'],
                    personality_philosophical: ['deep', 'meaningful', 'thought-provoking', 'reflective']
                };

                for (const key in enhancedFillers) {
                    if (prompt.includes(`{${key}}`)) {
                        const options = enhancedFillers[key];
                        const randomOption = options[Math.floor(Math.random() * options.length)];
                        prompt = prompt.replace(new RegExp(`{${key}}`, 'g'), randomOption);
                    }
                }

                return this.addContextualFlair(prompt);
            }

            applyPersonality(prompt) {
                const personalityMods = {
                    creative: {
                        prefixes: ['Imagine if...', 'What if we could...', 'Picture this:', 'Dream up...'],
                        suffixes: ['Let your creativity flow!', 'Think outside the box!', 'Be imaginative!']
                    },
                    analytical: {
                        prefixes: ['Let\'s analyze:', 'Consider this logically:', 'Break this down:', 'Think systematically:'],
                        suffixes: ['What\'s the reasoning behind this?', 'How would you structure this?', 'What patterns do you see?']
                    },
                    empathetic: {
                        prefixes: ['How do you feel about...', 'What touches your heart about...', 'Share your feelings on...'],
                        suffixes: ['I\'d love to understand your perspective.', 'Your feelings matter here.', 'Tell me what resonates with you.']
                    },
                    humorous: {
                        prefixes: ['Here\'s a fun question:', 'Let\'s lighten things up:', 'On the silly side:'],
                        suffixes: ['Make me laugh!', 'Keep it fun and light!', 'Bring some humor to this!']
                    },
                    philosophical: {
                        prefixes: ['Ponder this deeply:', 'Philosophically speaking:', 'In the grand scheme of things:'],
                        suffixes: ['What\'s the deeper meaning here?', 'How does this relate to life?', 'Think profoundly about this.']
                    }
                };

                const mods = personalityMods[this.currentPersonality];
                if (mods && Math.random() < 0.4) {
                    if (Math.random() < 0.5 && mods.prefixes.length > 0) {
                        const prefix = mods.prefixes[Math.floor(Math.random() * mods.prefixes.length)];
                        prompt = `${prefix} ${prompt}`;
                    } else if (mods.suffixes.length > 0) {
                        const suffix = mods.suffixes[Math.floor(Math.random() * mods.suffixes.length)];
                        prompt = `${prompt} ${suffix}`;
                    }
                }

                return prompt;
            }

            addContextualFlair(prompt) {
                const hour = new Date().getHours();
                const season = this.getCurrentSeason();
                const dayOfWeek = moment().format('dddd');
                
                // Time-based additions
                if (Math.random() < 0.2) {
                    if (hour < 12) {
                        return `🌅 Good morning! ${prompt}`;
                    } else if (hour < 17) {
                        return `☀️ ${prompt} Perfect for an afternoon chat!`;
                    } else {
                        return `🌆 ${prompt} Great evening conversation starter!`;
                    }
                }
                
                // Day-based additions
                if (Math.random() < 0.15) {
                    const dayAdditions = {
                        'Monday': 'Start your week with:',
                        'Friday': 'End your week discussing:',
                        'Saturday': 'Weekend vibes:',
                        'Sunday': 'Sunday reflection:'
                    };
                    
                    if (dayAdditions[dayOfWeek]) {
                        return `${dayAdditions[dayOfWeek]} ${prompt}`;
                    }
                }
                
                // Seasonal additions
                if (Math.random() < 0.1) {
                    const seasonalAdditions = {
                        spring: '🌸 with the fresh energy of spring',
                        summer: '☀️ perfect for summer vibes',
                        autumn: '🍂 cozy autumn thoughts',
                        winter: '❄️ warm winter conversations'
                    };
                    return `${prompt} ${seasonalAdditions[season]}`;
                }
                
                return prompt;
            }

            getCurrentSeason() {
                const month = new Date().getMonth();
                if (month >= 2 && month <= 4) return 'spring';
                if (month >= 5 && month <= 7) return 'summer';
                if (month >= 8 && month <= 10) return 'autumn';
                return 'winter';
            }

            showSuggestion() {
                const selectedValue = this.select.value;
                const prompts = this.currentLang === 'en' ? basePrompts : basePromptsThai;

                if (!selectedValue || !prompts[selectedValue]) {
                    this.suggestionDiv.innerHTML = this.currentLang === 'en' 
                        ? '<p>Please select a valid topic.</p>' 
                        : '<p>กรุณาเลือกหัวข้อที่ถูกต้อง</p>';
                    this.suggestionDiv.classList.add('show');
                    return;
                }

                // Show loading with better animation
                this.suggestionDiv.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loading"></div>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">
                            ${this.currentLang === 'en' ? 'Generating conversation starter...' : 'กำลังสร้างหัวข้อสนทนา...'}
                        </p>
                    </div>
                `;
                this.suggestionDiv.classList.add('show');

                // Simulate AI processing delay for better UX
                const processingTime = 500 + (this.dynamicWeight.value * 10);
                
                setTimeout(() => {
                    const mainCategory = this.getCategory(selectedValue);
                    const useDynamic = Math.random() < (this.dynamicWeight.value / 100);
                    
                    let suggestion;
                    if (useDynamic && dynamicTemplates[mainCategory]?.[selectedValue]) {
                        suggestion = this.generateDynamicPrompt(mainCategory, selectedValue);
                    } else {
                        suggestion = this.getUniquePrompt(prompts[selectedValue]);
                    }

                    const timestamp = moment().format('HH:mm');
                    const promptType = useDynamic ? 'AI-Generated' : 'Curated';
                    const confidenceScore = Math.floor(70 + Math.random() * 30);
                    
                    this.suggestionDiv.innerHTML = `
                        <div class="suggestion-item animate__animated animate__fadeInUp">
                            <div class="suggestion-text">${suggestion}</div>
                            <div class="suggestion-meta">
                                <div class="meta-item">
                                    <i class="fas fa-clock" aria-hidden="true"></i> ${timestamp}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-tag" aria-hidden="true"></i> ${promptType}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-robot" aria-hidden="true"></i> ${this.currentPersonality}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-language" aria-hidden="true"></i> ${this.currentLang.toUpperCase()}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-star" aria-hidden="true"></i> ${confidenceScore}% confidence
                                </div>
                            </div>
                            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button class="btn btn-secondary" onclick="app.ratePrompt(5)" 
                                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                        aria-label="Rate as excellent">
                                    😍 Love it
                                </button>
                                <button class="btn btn-secondary" onclick="app.ratePrompt(4)" 
                                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                        aria-label="Rate as good">
                                    👍 Good
                                </button>
                                <button class="btn btn-secondary" onclick="app.ratePrompt(3)" 
                                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                        aria-label="Rate as okay">
                                    😐 Okay
                                </button>
                                <button class="btn btn-secondary" onclick="app.ratePrompt(2)" 
                                        style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" 
                                        aria-label="Rate as poor">
                                    👎 Meh
                                </button>
                            </div>
                        </div>
                    `;

                    this.lastPrompt = suggestion;
                    this.stats.totalGenerated++;
                    this.updateUI();
                    this.saveStatsToStorage();

                    notyf.success('✨ New conversation starter generated!');
                    this.analytics.trackEvent('prompt_generated', { 
                        type: promptType, 
                        personality: this.currentPersonality,
                        topic: selectedValue,
                        confidence: confidenceScore
                    });
                }, processingTime);
            }

            showMultipleSuggestions(count) {
                const selectedValue = this.select.value;
                const prompts = this.currentLang === 'en' ? basePrompts : basePromptsThai;

                if (!selectedValue || !prompts[selectedValue]) {
                    notyf.error('Please select a valid topic first');
                    return;
                }

                // Show loading
                this.suggestionDiv.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loading"></div>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">
                            ${this.currentLang === 'en' ? `Generating ${count} conversation starters...` : `กำลังสร้าง ${count} หัวข้อสนทนา...`}
                        </p>
                    </div>
                `;
                this.suggestionDiv.classList.add('show');

                setTimeout(() => {
                    const mainCategory = this.getCategory(selectedValue);
                    const suggestions = new Set();
                    const maxAttempts = count * 4;
                    let attempts = 0;

                    while (suggestions.size < Math.min(count, Math.max(prompts[selectedValue].length, 10)) && attempts < maxAttempts) {
                        const useDynamic = Math.random() < (this.dynamicWeight.value / 100);
                        let suggestion;
                        
                        if (useDynamic && dynamicTemplates[mainCategory]?.[selectedValue]) {
                            suggestion = this.generateDynamicPrompt(mainCategory, selectedValue);
                        } else {
                            suggestion = this.getUniquePrompt(prompts[selectedValue]);
                        }
                        
                        suggestions.add(suggestion);
                        attempts++;
                    }

                    const timestamp = moment().format('HH:mm');
                    this.suggestionDiv.innerHTML = [...suggestions].map((suggestion, index) => `
                        <div class="suggestion-item animate__animated animate__fadeInUp" style="animation-delay: ${index * 0.1}s">
                            <div class="suggestion-text">${suggestion}</div>
                            <div class="suggestion-meta">
                                <div class="meta-item">
                                    <i class="fas fa-clock" aria-hidden="true"></i> ${timestamp}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-hashtag" aria-hidden="true"></i> ${index + 1} of ${suggestions.size}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-robot" aria-hidden="true"></i> ${this.currentPersonality}
                                </div>
                            </div>
                        </div>
                    `).join('');

                    this.stats.totalGenerated += suggestions.size;
                    this.updateUI();
                    this.saveStatsToStorage();

                    notyf.success(`🎉 Generated ${suggestions.size} conversation starters!`);
                    this.analytics.trackEvent('multiple_prompts_generated', { 
                        count: suggestions.size,
                        personality: this.currentPersonality 
                    });
                }, 800);
            }

            getCategory(topic) {
                return Object.keys(categoryMap).find(category => 
                    categoryMap[category].includes(topic)
                ) || '';
            }

            getUniquePrompt(prompts) {
                let attempts = 0;
                let suggestion;
                
                do {
                    suggestion = prompts[Math.floor(Math.random() * prompts.length)];
                    attempts++;
                } while (this.recentlyUsedPrompts.has(suggestion) && attempts < 15);

                this.recentlyUsedPrompts.add(suggestion);
                
                if (this.recentlyUsedPrompts.size > 20) {
                    const firstItem = this.recentlyUsedPrompts.values().next().value;
                    this.recentlyUsedPrompts.delete(firstItem);
                }

                return suggestion;
            }

            toggleLanguage(lang) {
                this.currentLang = lang;
                
                // Update button states with smooth transition
                document.getElementById('btn-en').classList.toggle('btn-primary', lang === 'en');
                document.getElementById('btn-en').classList.toggle('btn-secondary', lang !== 'en');
                document.getElementById('btn-th').classList.toggle('btn-primary', lang === 'th');
                document.getElementById('btn-th').classList.toggle('btn-secondary', lang !== 'th');
                
                this.showSuggestion();
                notyf.success(`🌐 Language switched to ${lang === 'en' ? 'English' : 'Thai'}`);
                this.analytics.trackEvent('language_changed', { language: lang });
            }

            saveFavorite() {
                if (!this.lastPrompt) {
                    notyf.error('Generate a prompt first!');
                    return;
                }

                const favorite = {
                    text: this.lastPrompt,
                    topic: this.select.value,
                    language: this.currentLang,
                    personality: this.currentPersonality,
                    timestamp: moment().format('YYYY-MM-DD HH:mm:ss'),
                    rating: null
                };

                // Check for duplicates
                const isDuplicate = this.favorites.some(fav => fav.text === favorite.text);
                if (isDuplicate) {
                    notyf.error('This prompt is already in your favorites!');
                    return;
                }

                this.favorites.unshift(favorite);
                this.favorites = this.favorites.slice(0, 100); // Keep only last 100
                
                this.updateUI();
                this.saveFavoritesToStorage();
                notyf.success('💖 Added to favorites!');
                this.analytics.trackEvent('favorite_saved', { 
                    topic: this.select.value,
                    personality: this.currentPersonality 
                });
            }

            removeFavorite(index) {
                if (confirm('Remove this conversation starter from favorites?')) {
                    this.favorites.splice(index, 1);
                    this.updateUI();
                    this.saveFavoritesToStorage();
                    notyf.success('Removed from favorites');
                    this.analytics.trackEvent('favorite_removed');
                }
            }

            reusePrompt(index) {
                const favorite = this.favorites[index];
                this.lastPrompt = favorite.text;
                
                // Set the topic and language
                this.select.value = favorite.topic;
                this.currentLang = favorite.language;
                this.toggleLanguage(favorite.language);
                
                // Display the prompt
                this.suggestionDiv.innerHTML = `
                    <div class="suggestion-item animate__animated animate__fadeInUp">
                        <div class="suggestion-text">${favorite.text}</div>
                        <div class="suggestion-meta">
                            <div class="meta-item">
                                <i class="fas fa-history" aria-hidden="true"></i> From favorites
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-calendar" aria-hidden="true"></i> ${moment(favorite.timestamp).format('MMM DD, YYYY')}
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-robot" aria-hidden="true"></i> ${favorite.personality || 'Unknown'}
                            </div>
                        </div>
                    </div>
                `;
                this.suggestionDiv.classList.add('show');
                
                notyf.success('♻️ Reusing favorite prompt!');
                this.analytics.trackEvent('favorite_reused');
            }

            ratePrompt(rating) {
                if (!this.lastPrompt) return;
                
                // Update stats
                if (this.stats.averageRating === 0) {
                    this.stats.averageRating = rating;
                } else {
                    this.stats.averageRating = (this.stats.averageRating + rating) / 2;
                }
                
                this.saveStatsToStorage();
                
                const ratingMessages = {
                    5: '🌟 Excellent! Thanks for the feedback!',
                    4: '👍 Great! We\'re glad you liked it!',
                    3: '😊 Thanks for the feedback!',
                    2: '💭 We\'ll work on improving!',
                    1: '📝 Thanks for the honest feedback!'
                };
                
                notyf.success(ratingMessages[rating] || 'Thanks for rating!');
                this.analytics.trackEvent('prompt_rated', { rating, topic: this.select.value });
                
                // Disable rating buttons after rating
                const ratingButtons = document.querySelectorAll('button[onclick^="app.ratePrompt"]');
                ratingButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                });
            }

            clearFavorites() {
                if (confirm('Are you sure you want to clear all favorites? This action cannot be undone.')) {
                    this.favorites = [];
                    this.updateUI();
                    this.saveFavoritesToStorage();
                    notyf.success('🗑️ All favorites cleared');
                    this.analytics.trackEvent('favorites_cleared');
                }
            }

            async sharePrompt() {
                if (!this.lastPrompt) {
                    notyf.error('Generate a prompt first!');
                    return;
                }

                const shareText = `💬 Conversation Starter: "${this.lastPrompt}"\n\n🤖 Generated by ThannxAI's Enhanced Topic Selector\n🌐 Try it: ${window.location.href}`;
                
                                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'AI Conversation Starter',
                            text: shareText,
                            url: window.location.href
                        });
                        notyf.success('📤 Shared successfully!');
                        this.analytics.trackEvent('prompt_shared', { method: 'native' });
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            this.fallbackShare(shareText);
                        }
                    }
                } else {
                    this.fallbackShare(shareText);
                }
            }

            fallbackShare(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        notyf.success('📋 Copied to clipboard! Share it anywhere!');
                        this.analytics.trackEvent('prompt_shared', { method: 'clipboard' });
                    }).catch(() => {
                        this.showShareModal(text);
                    });
                } else {
                    this.showShareModal(text);
                }
            }

            showShareModal(text) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                    background: rgba(0,0,0,0.8); z-index: 10000; 
                    display: flex; align-items: center; justify-content: center;
                    backdrop-filter: blur(5px);
                `;
                
                modal.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; margin: 1rem;">
                        <h3 style="margin-bottom: 1rem;">📤 Share Conversation Starter</h3>
                        <textarea readonly style="width: 100%; height: 120px; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; resize: none;">${text}</textarea>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: flex-end;">
                            <button onclick="this.closest('div').parentElement.remove()" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">Close</button>
                            <button onclick="navigator.clipboard.writeText('${text.replace(/'/g, "\\'")}').then(() => { notyf.success('Copied!'); this.closest('div').parentElement.remove(); })" style="padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">Copy</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
            }

            exportFavorites(format) {
                if (this.favorites.length === 0) {
                    notyf.error('No favorites to export!');
                    return;
                }

                const timestamp = moment().format('YYYY-MM-DD_HH-mm');
                const filename = `conversation-starters-${timestamp}`;

                switch (format) {
                    case 'json':
                        this.downloadFile(
                            JSON.stringify(this.favorites, null, 2),
                            `${filename}.json`,
                            'application/json'
                        );
                        break;
                    
                    case 'txt':
                        const txtContent = this.favorites.map((fav, index) => 
                            `${index + 1}. ${fav.text}\n   Topic: ${fav.topic} | Language: ${fav.language.toUpperCase()} | Date: ${moment(fav.timestamp).format('MMM DD, YYYY')}\n`
                        ).join('\n');
                        this.downloadFile(txtContent, `${filename}.txt`, 'text/plain');
                        break;
                    
                    case 'pdf':
                        this.exportToPDF(filename);
                        break;
                }

                notyf.success(`📁 Exported ${this.favorites.length} favorites as ${format.toUpperCase()}!`);
                this.analytics.trackEvent('favorites_exported', { format, count: this.favorites.length });
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }

            exportToPDF(filename) {
                if (typeof window.jsPDF === 'undefined') {
                    notyf.error('PDF export not available. Please try TXT format.');
                    return;
                }

                const { jsPDF } = window.jsPDF;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(102, 126, 234);
                doc.text('AI Conversation Starters', 20, 30);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Generated by ThannxAI | ${moment().format('MMMM DD, YYYY')}`, 20, 40);
                doc.text(`Total Favorites: ${this.favorites.length}`, 20, 50);
                
                // Content
                let yPosition = 70;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 20;
                const lineHeight = 10;
                
                this.favorites.forEach((fav, index) => {
                    if (yPosition > pageHeight - 40) {
                        doc.addPage();
                        yPosition = 30;
                    }
                    
                    // Number and topic
                    doc.setFontSize(10);
                    doc.setTextColor(102, 126, 234);
                    doc.text(`${index + 1}. ${fav.topic.toUpperCase()} | ${fav.language.toUpperCase()}`, margin, yPosition);
                    yPosition += lineHeight;
                    
                    // Prompt text
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0);
                    const splitText = doc.splitTextToSize(fav.text, 170);
                    doc.text(splitText, margin, yPosition);
                    yPosition += splitText.length * lineHeight;
                    
                    // Metadata
                    doc.setFontSize(8);
                    doc.setTextColor(128, 128, 128);
                    doc.text(`Date: ${moment(fav.timestamp).format('MMM DD, YYYY HH:mm')} | Personality: ${fav.personality || 'Unknown'}`, margin, yPosition);
                    yPosition += lineHeight * 1.5;
                });
                
                // Footer
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(128, 128, 128);
                    doc.text(`Page ${i} of ${totalPages} | ThannxAI Conversation Selector`, margin, pageHeight - 10);
                }
                
                doc.save(`${filename}.pdf`);
            }

            // Advanced features
            initializeAdvancedAnalytics() {
                // Track user behavior patterns
                this.behaviorTracker = {
                    sessionStart: Date.now(),
                    interactions: [],
                    preferences: {
                        favoriteTopics: {},
                        preferredPersonality: {},
                        languageUsage: { en: 0, th: 0 },
                        timeOfDayUsage: {}
                    }
                };

                // Track time of day usage
                const hour = new Date().getHours();
                const timeSlot = hour < 6 ? 'night' : hour < 12 ? 'morning' : hour < 18 ? 'afternoon' : 'evening';
                this.behaviorTracker.preferences.timeOfDayUsage[timeSlot] = 
                    (this.behaviorTracker.preferences.timeOfDayUsage[timeSlot] || 0) + 1;
            }

            generateInsights() {
                const insights = [];
                
                // Topic preferences
                if (Object.keys(this.stats.topTopics).length > 0) {
                    const topTopic = Object.keys(this.stats.topTopics).reduce((a, b) => 
                        this.stats.topTopics[a] > this.stats.topTopics[b] ? a : b
                    );
                    insights.push(`🎯 Your favorite topic is "${topTopic}"`);
                }
                
                // Personality insights
                if (Object.keys(this.stats.personalityUsage).length > 0) {
                    const topPersonality = Object.keys(this.stats.personalityUsage).reduce((a, b) => 
                        this.stats.personalityUsage[a] > this.stats.personalityUsage[b] ? a : b
                    );
                    insights.push(`🤖 You prefer "${topPersonality}" AI personality`);
                }
                
                // Usage patterns
                if (this.stats.totalGenerated > 10) {
                    insights.push(`📈 You're an active user with ${this.stats.totalGenerated} prompts generated!`);
                }
                
                if (this.stats.currentStreak > 3) {
                    insights.push(`🔥 Amazing ${this.stats.currentStreak}-day streak!`);
                }
                
                return insights;
            }

            showInsights() {
                const insights = this.generateInsights();
                if (insights.length === 0) {
                    notyf.info('Generate more prompts to see personalized insights!');
                    return;
                }
                
                const insightModal = document.createElement('div');
                insightModal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
                    background: rgba(0,0,0,0.8); z-index: 10000; 
                    display: flex; align-items: center; justify-content: center;
                    backdrop-filter: blur(5px);
                `;
                
                insightModal.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; margin: 1rem;">
                        <h3 style="margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-chart-line"></i> Your Conversation Insights
                        </h3>
                        <div style="margin-bottom: 1.5rem;">
                            ${insights.map(insight => `<p style="margin-bottom: 0.5rem; padding: 0.5rem; background: #f8fafc; border-radius: 6px;">${insight}</p>`).join('')}
                        </div>
                        <div style="text-align: right;">
                            <button onclick="this.closest('div').parentElement.remove()" 
                                    style="padding: 0.5rem 1rem; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(insightModal);
                insightModal.addEventListener('click', (e) => {
                    if (e.target === insightModal) insightModal.remove();
                });
            }

            // Accessibility improvements
            initializeAccessibility() {
                // Add keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.altKey) {
                        switch(e.key) {
                            case 'g':
                                e.preventDefault();
                                this.showSuggestion();
                                break;
                            case 's':
                                e.preventDefault();
                                this.saveFavorite();
                                break;
                            case 'f':
                                e.preventDefault();
                                this.select.focus();
                                break;
                        }
                    }
                });

                // Add focus management
                this.manageFocus();
                
                // Add screen reader announcements
                this.addScreenReaderSupport();
            }

            manageFocus() {
                // Ensure proper focus management for dynamic content
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList' && mutation.target === this.suggestionDiv) {
                            // Announce new content to screen readers
                            const announcement = document.createElement('div');
                            announcement.setAttribute('aria-live', 'polite');
                            announcement.setAttribute('aria-atomic', 'true');
                            announcement.className = 'sr-only';
                            announcement.textContent = 'New conversation starter generated';
                            document.body.appendChild(announcement);
                            
                            setTimeout(() => document.body.removeChild(announcement), 1000);
                        }
                    });
                });

                observer.observe(this.suggestionDiv, { childList: true });
            }

            addScreenReaderSupport() {
                // Add helpful descriptions for screen readers
                const descriptions = {
                    'topicSelect': 'Choose from various conversation categories including hobbies, advice, and educational topics',
                    'dynamicWeight': 'Adjust how creative the AI should be when generating prompts. Higher values mean more creative and unique suggestions',
                    'personalitySelect': 'Select the AI personality style for generating conversation starters'
                };

                Object.entries(descriptions).forEach(([id, description]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.setAttribute('aria-describedby', `${id}-description`);
                        
                        const descElement = document.createElement('div');
                        descElement.id = `${id}-description`;
                        descElement.className = 'sr-only';
                        descElement.textContent = description;
                        element.parentNode.appendChild(descElement);
                    }
                });
            }

            // Performance optimizations
            initializePerformanceOptimizations() {
                // Lazy load heavy features
                this.lazyLoadFeatures();
                
                // Implement virtual scrolling for large lists
                this.implementVirtualScrolling();
                
                // Add service worker for offline functionality
                this.registerServiceWorker();
            }

            lazyLoadFeatures() {
                // Load PDF export only when needed
                window.exportToPDF = () => {
                    if (!window.jsPDF) {
                        const script = document.createElement('script');
                        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                        script.onload = () => this.exportFavorites('pdf');
                        document.head.appendChild(script);
                    } else {
                        this.exportFavorites('pdf');
                    }
                };
            }

            implementVirtualScrolling() {
                // For large favorite lists, implement virtual scrolling
                if (this.favorites.length > 50) {
                    // Implementation would go here for very large lists
                    console.log('Virtual scrolling would be implemented for large lists');
                }
            }

            registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js')
                        .then(() => console.log('Service Worker registered'))
                        .catch(() => console.log('Service Worker registration failed'));
                }
            }
        }

        // Theme management
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            
            document.getElementById('theme-icon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('darkMode', isDark);
            
            notyf.success(`🎨 Switched to ${isDark ? 'dark' : 'light'} mode`);
        }

        // Load saved theme
        function loadTheme() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-icon').className = 'fas fa-sun';
            }
        }

        // Enhanced conversation data with more variety and cultural sensitivity
        const basePrompts = {
            // ... (keeping all the original prompts and adding more)
            hobbies: [
                "What hobby have you always wanted to try but haven't had the chance to yet?",
                "If you could master any skill instantly, what would it be and why?",
                "What's a hobby that others might find unusual but you absolutely love?",
                "How has one of your hobbies changed your perspective on life?",
                "What's the most expensive thing you've bought for a hobby?",
                "Which hobby of yours would you love to turn into a career?",
                "What hobby did you have as a child that you'd like to pick up again?",
                "How do you balance multiple hobbies with your other responsibilities?",
                "What's a hobby that you think everyone should try at least once?",
                "Which of your hobbies has taught you the most about yourself?"
            ],
            // ... (continuing with enhanced prompts for all categories)
        };

        // Enhanced Thai prompts with cultural context
        const basePromptsThai = {
            hobbies: [
                "งานอดิเรกไหนที่คุณอยากลองทำแต่ยังไม่มีโอกาส?",
                "ถ้าคุณสามารถเชี่ยวชาญทักษะใดๆ ได้ทันที คุณจะเลือกอะไรและทำไม?",
                "งานอดิเรกไหนที่คนอื่นอาจคิดว่าแปลก แต่คุณชอบมาก?",
                "งานอดิเรกของคุณเปลี่ยนมุมมองชีวิตคุณอย่างไรบ้าง?",
                "สิ่งที่แพงที่สุดที่คุณเคยซื้อเพื่องานอดิเรกคืออะไร?",
                "งานอดิเรกไหนที่คุณอยากเปลี่ยนให้เป็นอาชีพ?",
                "งานอดิเรกสมัยเด็กไหนที่คุณอยากกลับมาทำอีก?",
                "คุณสมดุลงานอดิเรกหลายๆ อย่างกับความรับผิดชอบอื่นๆ อย่างไร?",
                "งานอดิเรกไหนที่คุณคิดว่าทุกคนควรลองทำสักครั้ง?",
                "งานอดิเรกไหนที่สอนให้คุณรู้จักตัวเองมากที่สุด?"
            ],
            // ... (continuing with all Thai categories)
        };

        // Enhanced dynamic templates with personality-based variations
        const dynamicTemplates = {
            "open_chit_chat": {
                hobbies: [
                    "What's a {emotion} hobby that brings you {feeling} whenever you think about it?",
                    "If you could {action} any hobby with unlimited resources, what would you choose?",
                    "What hobby makes you lose track of time completely?",
                    "Share a hobby that connects you with your {personality_creative} side",
                    "What's a hobby that challenges your {personality_analytical} thinking?",
                    "Tell me about a hobby that makes you feel {personality_empathetic} towards others",
                    "What hobby always makes you {personality_humorous} and brings joy?",
                    "Share a hobby that gets you thinking {personality_philosophical} about life"
                ],
                // ... (continuing with enhanced templates)
            }
            // ... (all other categories)
        };

        // Enhanced category mapping
        const categoryMap = {
            "open_chit_chat": ["hobbies", "food", "movies", "music", "family", "work_school", "nostalgia", "future", "hypothetical", "problem_solving", "humor", "philosophy", "fact_finding"],
            "advice_support": ["self_help", "personal_dev", "emotional", "cultural", "parenting", "work_advice", "transitions", "addiction", "identity", "psych_consult", "business_insights"],
            "information_seeking": ["travel", "cooking", "entertainment", "sports", "diy", "finance", "business_info", "tech", "general_knowledge", "civics", "politics"],
            "educational": ["meditation", "psychology", "virtual_trip"]
        };

        // Enhanced fillers with more variety
        const fillers = {
            emotion: ["excited", "curious", "passionate", "thoughtful", "enthusiastic", "inspired", "motivated", "fascinated"],
            feeling: ["joy", "peace", "excitement", "fulfillment", "satisfaction", "wonder", "contentment"],
            action: ["explore", "master", "discover", "create", "build", "learn", "experience", "develop"],
            timeframe: ["recently", "this week", "lately", "in the past month", "nowadays", "these days"],
            intensity: ["really", "absolutely", "completely", "totally", "genuinely", "truly", "deeply"]
        };

        // Initialize the application
        let app;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            app = new TopicSelectorApp();
            
            // Add insights button to controls
            const insightsBtn = document.createElement('button');
            insightsBtn.className = 'btn btn-secondary';
            insightsBtn.innerHTML = '<i class="fas fa-chart-line" aria-hidden="true"></i> Insights';
            insightsBtn.onclick = () => app.showInsights();
            insightsBtn.setAttribute('aria-label', 'View usage insights and statistics');
            
            const controls = document.querySelector('.controls');
            controls.appendChild(insightsBtn);
            
            // Show welcome message for new users
            if (!localStorage.getItem('hasVisited')) {
                setTimeout(() => {
                    notyf.open({
                        type: 'info',
                        message: '🎉 Welcome! Use keyboard shortcuts: Ctrl+Enter (generate), Ctrl+S (save), Alt+F (focus topic)'
                    });
                    localStorage.setItem('hasVisited', 'true');
                }, 2000);
            }
            
            console.log('🤖 ThannxAI Conversation Selector loaded successfully!');
        });

        // Global functions for button onclick handlers
        function showSuggestion() { app.showSuggestion(); }
        function showMultipleSuggestions(count) { app.showMultipleSuggestions(count); }
        function toggleLanguage(lang) { app.toggleLanguage(lang); }
        function saveFavorite() { app.saveFavorite(); }
        function sharePrompt() { app.sharePrompt(); }
        function exportFavorites(format) { app.exportFavorites(format); }
        function clearFavorites() { app.clearFavorites(); }
    </script>

    <!-- Enhanced Manifest -->
    <script>
        // Update manifest dynamically
        const manifestContent = {
            "name": "ThannxAI - Enhanced Conversation Topic Selector",
            "short_name": "ThannxAI Topics",
            "description": "AI-powered conversation starter generator with advanced features. Created by Thanattsitt Thanatt (ThannxAI) - AI Developer & Quantum Psychologist",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#667eea",
            "orientation": "portrait-primary",
            "scope": "/",
            "lang": "en",
            "dir": "ltr",
            "categories": ["education", "productivity", "technology", "social", "communication"],
            "iarc_rating_id": "e84b072d-71b3-4d3e-86ae-31a8ce4e53b7",
            "prefer_related_applications": false,
            "edge_side_panel": {
                "preferred_width": 400
            },
            "screenshots": [
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=1280&h=720&q=80",
                    "sizes": "1280x720",
                    "type": "image/png",
                    "form_factor": "wide",
                    "label": "Main interface showing conversation topic selection"
                },
                {
                    "src": "https://images.unsplash.com/photo-1494790108755-2616b612b1e4?ixlib=rb-4.0.3&auto=format&fit=crop&w=750&h=1334&q=80",
                    "sizes": "750x1334",
                    "type": "image/png",
                    "form_factor": "narrow",
                    "label": "Mobile view of conversation starters"
                }
            ],
            "icons": [
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=72&h=72&q=80",
                    "sizes": "72x72",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=96&h=96&q=80",
                    "sizes": "96x96",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=128&h=128&q=80",
                    "sizes": "128x128",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=144&h=144&q=80",
                    "sizes": "144x144",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=152&h=152&q=80",
                    "sizes": "152x152",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=192&h=192&q=80",
                    "sizes": "192x192",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=384&h=384&q=80",
                    "sizes": "384x384",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=512&h=512&q=80",
                    "sizes": "512x512",
                    "type": "image/png",
                    "purpose": "any maskable"
                }
            ],
            "shortcuts": [
                {
                    "name": "Generate Topic",
                    "short_name": "Generate",
                    "description": "Quickly generate a new conversation starter",
                    "url": "/?action=generate",
                    "icons": [
                        {
                            "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=96&h=96&q=80",
                            "sizes": "96x96"
                        }
                    ]
                },
                {
                    "name": "View Favorites",
                    "short_name": "Favorites",
                    "description": "Access your saved conversation starters",
                    "url": "/?action=favorites",
                    "icons": [
                        {
                            "src": "https://images.unsplash.com/photo-1677442136019-21780ecad995?ixlib=rb-4.0.3&auto=format&fit=crop&w=96&h=96&q=80",
                            "sizes": "96x96"
                        }
                    ]
                }
            ],
            "share_target": {
                "action": "/share-target/",
                "method": "GET",
                "params": {
                    "title": "title",
                    "text": "text",
                    "url": "url"
                }
            }
        };

        // Create and inject manifest
        const manifestBlob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const manifestLink = document.querySelector('link[rel="manifest"]');
        if (manifestLink) {
            manifestLink.href = manifestURL;
        }
    </script>

    <!-- Google Analytics (placeholder) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'AI Conversation Topic Selector',
            page_location: window.location.href,
            content_group1: 'AI Tools',
            content_group2: 'Communication',
            custom_map: {
                'custom_parameter_1': 'creator_name'
            },
            creator_name: 'ThannxAI'
        });
    </script>

    <!-- Schema.org structured data for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "WebSite",
                "@id": "https://conversation-topics.thannx.ai/#website",
                "url": "https://conversation-topics.thannx.ai/",
                "name": "ThannxAI Conversation Topic Selector",
                "description": "AI-powered conversation starter generator",
                "publisher": {
                    "@id": "https://thannx.ai/#organization"
                },
                "potentialAction": [
                    {
                        "@type": "SearchAction",
                        "target": {
                            "@type": "EntryPoint",
                            "urlTemplate": "https://conversation-topics.thannx.ai/?topic={search_term_string}"
                        },
                        "query-input": "required name=search_term_string"
                    }
                ],
                "inLanguage": "en-US"
            },
            {
                "@type": "Organization",
                "@id": "https://thannx.ai/#organization",
                "name": "ThannxAI",
                "alternateName": "Thanattsitt Thanatt",
                "url": "https://thannx.ai/",
                "logo": {
                    "@type": "ImageObject",
                    "inLanguage": "en-US",
                    "@id": "https://thannx.ai/#/schema/logo/image/",
                    "url": "https://thannx.ai/logo.png",
                    "contentUrl": "https://thannx.ai/logo.png",
                    "width": 512,
                    "height": 512,
                    "caption": "ThannxAI"
                },
                "image": {
                    "@id": "https://thannx.ai/#/schema/logo/image/"
                },
                "sameAs": [
                    "https://linkedin.com/in/thanattsitt-thanatt",
                    "https://github.com/thannxai",
                    "https://twitter.com/thannxai"
                ],
                "founder": {
                    "@type": "Person",
                    "name": "Thanattsitt Thanatt",
                    "jobTitle": "AI Developer & Quantum Psychologist",
                    "description": "Bridging Artificial Intelligence with Human Consciousness"
                }
            },
            {
                "@type": "BreadcrumbList",
                "itemListElement": [
                    {
                        "@type": "ListItem",
                        "position": 1,
                        "name": "Home",
                        "item": "https://thannx.ai/"
                    },
                    {
                        "@type": "ListItem",
                        "position": 2,
                        "name": "AI Tools",
                        "item": "https://thannx.ai/tools/"
                    },
                    {
                        "@type": "ListItem",
                        "position": 3,
                        "name": "Conversation Topic Selector",
                        "item": "https://conversation-topics.thannx.ai/"
                    }
                ]
            }
        ]
    }
    </script>

    <!-- Performance monitoring -->
    <script>
        // Monitor Core Web Vitals
        function getCLS(onPerfEntry) {
            if (onPerfEntry && onPerfEntry instanceof Function) {
                import('web-vitals').then(({getCLS}) => getCLS(onPerfEntry));
            }
        }

        function getFID(onPerfEntry) {
            if (onPerfEntry && onPerfEntry instanceof Function) {
                import('web-vitals').then(({getFID}) => getFID(onPerfEntry));
            }
        }

        function getFCP(onPerfEntry) {
            if (onPerfEntry && onPerfEntry instanceof Function) {
                import('web-vitals').then(({getFCP}) => getFCP(onPerfEntry));
            }
        }

        function getLCP(onPerfEntry) {
            if (onPerfEntry && onPerfEntry instanceof Function) {
                import('web-vitals').then(({getLCP}) => getLCP(onPerfEntry));
            }
        }

        function getTTFB(onPerfEntry) {
            if (onPerfEntry && onPerfEntry instanceof Function) {
                import('web-vitals').then(({getTTFB}) => getTTFB(onPerfEntry));
            }
        }

        function sendToAnalytics(metric) {
            if (typeof gtag !== 'undefined') {
                gtag('event', metric.name, {
                    event_category: 'Web Vitals',
                    event_label: metric.id,
                    value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
                    non_interaction: true,
                });
            }
        }

        getCLS(sendToAnalytics);
        getFID(sendToAnalytics);
        getFCP(sendToAnalytics);
        getLCP(sendToAnalytics);
        getTTFB(sendToAnalytics);
    </script>
</body>
</html>
